+function(a){var b=function(c){this.options=a.extend({},b.DEFAULTS,c);var d=this;this.options.computeBtn.click(function(){d.getParams()})};b.VERSION="1.0.0";b.DEFAULTS={};b.prototype.toArray=function(c){return c.split(",")};b.prototype.getParams=function(){var e=this.serializeJson();var d={names:this.toArray(e.names)||[],totals:this.toArray(e.totals)||[],numbers:Number(e.numbers)||1,packingCost:Number(e.packingCost)||0,deliveryCost:Number(e.deliveryCost)||0,extraCost:Number(e.extraCost)||0,restaurantDiscount:Number(e.restaurantDiscount)||0,luckDiscount:Number(e.luckDiscount)||0,extraDiscount:Number(e.extraDiscount)||0};var c=this.showMsg(d);this.showPriceList(d,c)};b.prototype.showMsg=function(g){var d=this.discountTotal(g);var e=this.costTotal(g);var f=(d-e)/g.numbers;var c="";if(f>0){c="恭喜，省钱了！"}else{if(f<0){c="抱歉，得倒贴钱！"}else{c="还行吧，不赔不赚！"}}this.options.resWrapper.fadeIn();this.options.resMsg.find("h2").html(c);this.options.resMsg.find(".price").html(f);return f};b.prototype.showPriceList=function(h,e){var d=h.totals;var g={};var j="";for(var c=0;c<d.length;c++){g={name:h.names[c]||"xxx"+c,originalCost:d[c],afterDiscount:this.getFloat(d[c]-e,1)};j+="<tr>"+"<td>"+g.name+"</td>"+"<td>"+g.originalCost+"</td>"+"<td>"+g.afterDiscount+"</td>"+"</tr>"}this.options.resList.html(j);var f=this.getRandom(0,h.numbers-1)||0;this.options.who.html(h.names[f]+"大佬")};b.prototype.getRandom=function(f,c){f=f||0;var d=c-f;var g=Math.random();var e=f+Math.round(g*d);return e};b.prototype.getFloat=function(c,d){d=Number(d)||1;return Math.round(c*Math.pow(10,d))/Math.pow(10,d)};b.prototype.discountTotal=function(c){return c.restaurantDiscount+c.luckDiscount+c.extraDiscount};b.prototype.costTotal=function(c){return c.packingCost+c.deliveryCost+c.extraCost};b.prototype.serializeJson=function(){var c={};var d=this.options.takeOutForm.serializeArray();a(d).each(function(){if(!c[this.name]){c[this.name]=this.value}});return c};a(function(){new b({takeOutForm:a("#takeOutForm"),computeBtn:a("#computeBtn"),resWrapper:a("#resWrapper"),resMsg:a("#resMsg"),resList:a("#resList"),who:a("#who")})})}(jQuery);
